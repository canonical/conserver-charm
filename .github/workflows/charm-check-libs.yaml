name: Check Charm libraries
permissions: {}
on:
  pull_request:
    paths:
      - lib/**
      - src/**
      - charmcraft.yaml
      - requirements.txt
  workflow_dispatch:
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  check-libs:
    name: Check Charm libraries
    runs-on: ubuntu-22.04
    permissions:
      contents: read
      pull-requests: write # required to label PR based on results
    steps:
      - uses: actions/checkout@v5
        with:
          persist-credentials: false
      - name: Check libraries
        uses: canonical/charming-actions/check-libraries@1.0.3
        with:
          credentials: ${{ secrets.CHARMHUB_TOKEN }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
